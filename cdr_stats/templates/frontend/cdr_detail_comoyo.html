{% extends "frontend/master.html" %}
{% load i18n cdr_extras common_tags %}

{% block content %}

{% for element in row %}
    <font size="4"><b>General</b><br></font>
    From number : {{ element.caller_id_number }}<br>
    To number : {{ element.destination_number }}<br>
    Call-ID : {{ element.call_id }}<br>
    Start : {{ element.start_uepoch|date:"r" }}<br>
    End : {{ element.end_uepoch|date:"r" }}<br>
    {% if element.answer_uepoch %}
        Answer : {{ element.answer_uepoch|date:"r" }}<br>
    {% else %}
        No Answer<br>
    {% endif %}
    {% if element.duration %}
        Duration : {{ element.duration }} Sec<br>
    {% endif %}
    {% if element.billsec %}
        Talk time : {{ element.billsec }} Sec<br>
    {% endif %}
    {% if element.bill_amount %}
        Billed Amount : {{ element.bill_amount }}<br>
    {% endif %}
    {% if element.bill_sku %}
        Bill Method : {{ element.bill_sku }}<br>
    {% endif %}
    {% if element.caller_id_number_hash %}
        Kiss's Customer ID: {{ element.caller_id_number_hash }}<br>
    {% endif %}

    {% if element.client_max_rtt %}
        <p/>
        <p/>
        <p/>
        <font size="4"><b>IP End-to-end Statistics</b><br></font>
        Max roundtrip delay : {{ element.client_max_rtt }} ms<br>
        Far End packet loss : {{ element.client_max_tx_packet_loss }}<br>


        <p/>
        <b>Far End to Client stats</b><br>
        Client average of packet loss : {{ element.client_rx_fraction_loss }} %<br>
        Client packets recieved : {{ element.client_rx_packets }}<br>
        Client packets lost : {{ element.client_rx_packets_lost }}<br>
        Client packets sent: {{ element.client_tx_packets }}<br>
        {% if element.client_hangup %}
            Client hangup reason (SIP) : {{ element.client_hangup }}<br>
        {% endif %}
    {% endif %}

    {% if element.client_call_quality.q_avg %}
        <p/>
        <p/>
        <b>Q Values (end user perceived quality)</b><br>
        Q Distribution:</b><br>
        100: {{ element.client_call_quality.q_100 }} &nbsp
        90: {{ element.client_call_quality.q_90 }} &nbsp
        80: {{ element.client_call_quality.q_80 }} &nbsp
        70: {{ element.client_call_quality.q_70 }} &nbsp
        60: {{ element.client_call_quality.q_60 }} &nbsp
        50: {{ element.client_call_quality.q_50 }} &nbsp
        40: {{ element.client_call_quality.q_40 }} &nbsp
        30: {{ element.client_call_quality.q_30 }} &nbsp
        20: {{ element.client_call_quality.q_20 }} &nbsp
        10: {{ element.client_call_quality.q_10 }} &nbsp<br>
        Average Q value: {{ element.client_call_quality.q_avg }}<br>
        <p/>
    {% endif %}

    <p/>
    <p/>
    <p/>
    {% if element.midee_statistics.counter_connections  %}
        <font size="4"><b>Media Relay (Midee Statistics)</b><br></font>
        Username : {{ element.midee_statistics.username }}<br>
        Uptime : {{ element.midee_statistics.uptime }}<br>
        Footee_id : {{ element.midee_statistics.footee_id }}<br>
        Counter_connections : {{ element.midee_statistics.counter_connections }}<br>
    {% endif %}

    <p/>

    {% for connection in element.midee_statistics.connections %}
        {% for item in connection %}
            {% if item == "c_type" %}
                {% if connection.c_type == "internal" %}
                    <b>Direction : Far End to Media Relay</b><br>
                {% endif %}
                {% if connection.c_type == "external" %}
                    <b>Direction : Client to Media Relay</b><br>
                {% endif %}
            {% endif %}
            {% if item == "c_transport" %}
                Transport : {{ connection.c_transport }}<br>
            {% endif %}
            {% if item == "c_dest" %}
                Remote/SIP Trunk IP:PORT for RTP : {{ connection.c_dest }}<br>
            {% endif %}
            {% if item == "c_dest_rtcp" %}
                Remote/SIP Trunk IP:PORT for RTCP : {{ connection.c_dest_rtcp }}<br>
            {% endif %}
            {% if item == "c_client_public_ip" %}
                Client public IP : 
                <A HREF="http://www.geoiptool.com/en/?IP={{ connection.c_client_public_ip|slice:":-6"}}" target="_blank">{{ connection.c_client_public_ip }}</a>
                <A HREF="http://api.hostip.info/get_html.php?ip={{ connection.get_first }}" target="_blank"> Lookup IP origin</a><br>
            {% endif %}
            {% if item == "c_tx_packets" %}
                Packets sent : {{ connection.c_tx_packets }}<br>
            {% endif %}
            {% if item == "c_tx_rtcp_packets" %}
                RTCP reports sent : {{ connection.c_tx_rtcp_packets }}<br>
            {% endif %}
            {% if item == "c_tx_lost_packets" %}
                Lost packets : {{ connection.c_tx_lost_packets }}<br>
            {% endif %}
            {% if item == "c_tx_loss" %}
                Packet loss : {{ connection.c_tx_loss }} %<br>
            {% endif %}
            {% if item == "c_tx_ordered_packets" %}
                Out-of-sequence packets : {{ connection.c_tx_ordered_packets }}<br>
            {% endif %}
            {% if item == "c_tx_expected_packets" %}
                Expected packets : {{ connection.c_tx_expected_packets }}<br>
            {% endif %}
            {% if item == "c_remote_ip" %}
                Remote/SIP Trunk IP:PORT : {{ connection.c_remote_ip }}<br>
            {% endif %}
            {% if item == "c_client_rtt_min" %}
                Midee to client RTT Min : {{ connection.c_client_rtt_min }} ms<br>
            {% endif %}
            {% if item == "c_client_rtt_avg" %}
                Midee to client RTT Average : {{ connection.c_client_rtt_avg }} ms<br>
            {% endif %}
            {% if item == "c_client_rtt_max" %}
                Midee to client RTT Max : {{ connection.c_client_rtt_max }} ms<br>
            {% endif %}
        {% endfor %}
    <p/>
    {% endfor %}

{% endfor %}

{% endblock %}
